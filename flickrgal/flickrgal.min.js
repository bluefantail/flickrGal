/*! flickrgal 2016-04-26 */
function handle_click(a){var b=a.currentTarget,c=b.className;switch(c){case"album":var d=b.id;backButton.classList.remove("hide"),build_images(d),window.scroll(0,0);break;case"image":var e=b.id,f=b.getAttribute("album-id");build_lightbox(e,f),lightbox.classList.remove("hide");break;case"navigate-back":imageGrid.innerHTML="";for(var g in prevState)element=prevState[g],imageGrid.appendChild(element);backButton.classList.add("hide"),loadingMessage.style.display="none",window.scroll(0,0);break;case"close":lightbox.classList.add("hide");break;case"prev":prev();break;case"next":next()}}function handle_keys(a){var b=a.keyCode;switch(b){case 39:next();break;case 37:prev();break;case 27:lightbox.classList.add("hide")}}function prev(){var a=document.getElementById(lightboxSet[0]);a.classList.add("hide-stage-image");var b=lightboxSet.pop();lightboxSet.unshift(b),a=document.getElementById(lightboxSet[0]),a.classList.remove("hide-stage-image"),lightboxTitle.innerHTML=a.dataset.title,lightboxDesc.innerHTML=a.dataset.description}function next(){var a=document.getElementById(lightboxSet[0]);a.classList.add("hide-stage-image");var b=lightboxSet.shift();lightboxSet.push(b),a=document.getElementById(lightboxSet[0]),a.classList.remove("hide-stage-image"),lightboxTitle.innerHTML=a.dataset.title,lightboxDesc.innerHTML=a.dataset.description}function Element(a){this.el=document.createElement("div"),this.el.className=a,this.loading=document.createElement("div"),this.loading.className="image-loading",this.inner=document.createElement("div"),this.inner.className="inner",this.dummy=document.createElement("div"),this.dummy.className="dummy",this.title=document.createElement("div"),this.desc=document.createElement("div")}function make_request(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.requestType=b,d.requestID=c,d.onload=handle_request,d.send()}function handle_request(a){var b=a.target,c=JSON.parse(b.responseText),d=b.requestType,e=b.requestID;if(b.readyState===XMLHttpRequest.DONE)if(200===b.status)switch(console.log(d+" request succeed"),console.log("Response JSON:"),console.log(c),d){case"collections":build_collections(c);break;case"photosets":build_albums(c,e);break;case"photo":}else console.log("Flickr "+requestType+" request failed!")}function get_album_pos(a){var b="";for(var c in albums)albums[c].id==a?b=c:!1;return b}function to_lower_case(a){for(name in a)a[name]=a[name].toLowerCase();return a}function fade_in_image(a,b){var c=document.getElementById(a);c.style.backgroundImage="url("+b+")";var d=c.querySelector(".image-loading");d?d.style.opacity=0:!1}function build_image_url(a,b){var c="https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+b+".jpg";return c}function build_collections(a){var b=a.collections.collection;for(collection in b){var c=b[collection];if(getAll){collections.push(c);var d=c.set;for(set in d)albums.push({id:d[set].id,title:d[set].title,description:d[set].description,images:[]})}else{var e=b[collection].title.toLowerCase();if(collectionsRequested.indexOf(e)>=0){collections.push(c);var d=c.set;for(set in d)albums.push({id:d[set].id,title:d[set].title,description:d[set].description,images:[]})}}}loadingMessage.style.display="none",Array.prototype.forEach.call(albums,function(a){var b=new Element("album");b.el.id=a.id,b.title.innerHTML=a.title,b.inner.appendChild(b.title),b.el.appendChild(b.loading),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),b.el.addEventListener("click",handle_click),imageGrid.appendChild(b.el),prevState.push(b.el)}),Array.prototype.forEach.call(albums,function(a){var b=endpoint+methodPhotos+"&photoset_id="+a.id+params+"&extras=description";make_request(b,"photosets",a.id)}),gallery.classList.remove("hide")}function build_albums(a,b){var c=get_album_pos(b),d=a.photoset.photo;Array.prototype.forEach.call(d,function(a){var d={};if(d.id=a.id,d.farm=a.farm,d.server=a.server,d.secret=a.secret,d.title=a.title,d.description=a.description,d.is_primary=a.isprimary,albums[c].images.push(d),1==d.is_primary){var e=build_image_url(d,"z");fade_in_image(b,e)}})}function build_images(a){imageGrid.innerHTML="";var b=get_album_pos(a),c=albums[b].images;Array.prototype.forEach.call(c,function(b){var c=build_image_url(b,"z"),d=new Element("image"),e=b.id;d.el.id=e,d.el.setAttribute("album-id",a),d.el.appendChild(d.dummy),d.el.appendChild(d.inner),d.el.addEventListener("click",handle_click),imageGrid.appendChild(d.el),fade_in_image(e,c)})}function build_lightbox(a,b){lightboxSet=[];var c=get_album_pos(b),d=albums[c].images,e="stage-"+a;imageBox.innerHTML="",Array.prototype.forEach.call(d,function(a){var b=document.getElementById(a.id),c=b.style.backgroundImage,d=document.createElement("div");d.id="stage-"+a.id,d.classList.add("hide-stage-image"),d.style.backgroundImage=c,d.dataset.title=a.title,d.dataset.description=a.description._content,largeImageUrl=build_image_url(a,"b"),d.innerHTML='<div style="background-image: url('+largeImageUrl+')"></div>',imageBox.appendChild(d),lightboxSet.push(d.id)});var f=lightboxSet.indexOf(e),g=lightboxSet.slice(f),h=lightboxSet.slice(0,f);lightboxSet=g.concat(h),lightboxTitle.innerHTML=document.getElementById(lightboxSet[0]).dataset.title,lightboxDesc.innerHTML=document.getElementById(lightboxSet[0]).dataset.description,document.getElementById(e).classList.remove("hide-stage-image")}var flickrApiKey="35ca9893a15649318240594ad7dd98e7",flickrApiSecret="c440757b04345ffe",flickrUserId="141088533@N02",endpoint="https://api.flickr.com/services/rest/?method=",params="&format=json&nojsoncallback=1&api_key="+flickrApiKey+"&user_id="+flickrUserId,methodCollection="flickr.collections.getTree",methodPhotos="flickr.photosets.getPhotos",collections=[],albums=[],lightboxSet=[],prevState=[],lightboxTemplate=document.createElement("div");lightboxTemplate.id="lightbox",lightboxTemplate.className="hide";var lightboxUi=document.createElement("div");lightboxUi.id="lightbox-ui";var imageStageEl=document.createElement("div");imageStageEl.id="stage";var lightboxControls='<div class="close" title="Close (Esc)"></div><div id="controls"><div id="arrow-left" class="prev" title="Prev"></div><div id="arrow-right" class="next" title="Next"></div></div>',infoEl='<div id="info_container"><div id="info"><div id="title"></div><div id="description"></div></div></div>',imageBoxEl='<div id="image-box-container"><div><div id="image-box"></div></div></div>';lightboxUi.innerHTML=lightboxControls+infoEl,imageStageEl.innerHTML=imageBoxEl,lightboxTemplate.appendChild(lightboxUi),lightboxTemplate.appendChild(imageStageEl);var gallery=document.querySelector("#flickrgal");if(gallery){gallery.className="hide";var galleryNavigation='<div id="navigation-container"><div class="navigate-back hide"><div>Back</div></div></div>',loadingGallery='<div id="loading-gallery"><div>Loading...</div></div>',imageGridBox='<div id="image-grid"></div>',getAll=!1,collectionsRequested=gallery.dataset.collections;collectionsRequested=JSON.parse(collectionsRequested),collectionsRequested=to_lower_case(collectionsRequested),getAll=collectionsRequested.indexOf("all")>=0,gallery.insertAdjacentHTML("afterbegin",galleryNavigation),gallery.insertAdjacentHTML("afterbegin",loadingGallery),gallery.insertAdjacentHTML("beforeend",imageGridBox),gallery.appendChild(lightboxTemplate);var imageGrid=document.querySelector("#image-grid"),lightbox=document.querySelector("#lightbox"),imageBox=document.querySelector("#image-box"),lightboxTitle=document.querySelector("#info > #title"),lightboxDesc=document.querySelector("#info > #description"),loadingMessage=document.querySelector("#loading-gallery"),closeButton=document.querySelector(".close"),backButton=document.querySelector(".navigate-back"),prevButton=document.querySelector(".prev"),nextButton=document.querySelector(".next");closeButton.addEventListener("click",handle_click),backButton.addEventListener("click",handle_click),prevButton.addEventListener("click",handle_click),nextButton.addEventListener("click",handle_click),window.addEventListener("keydown",handle_keys),console.log("Requested Collections: "+collectionsRequested);var url=endpoint+methodCollection+params;make_request(url,"collections")}